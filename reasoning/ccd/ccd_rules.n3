PREFIX list: <http://www.w3.org/2000/10/swap/list#>
PREFIX math: <http://www.w3.org/2000/10/swap/math#>
PREFIX log: <http://www.w3.org/2000/10/swap/log#>
PREFIX e: <http://eulersharp.sourceforge.net/2003/03swap/log-rules#>
PREFIX ccd: <http://josd.github.io/eye/reasoning/ccd#>

{
    (?A ?B) ccd:transformer (?Y ?Z).
} <= {
    ?SCOPE e:findall (
        (?H ?F ?G ?J ?K)
        {
            ?A math:memberCount ?I.
            ?A list:member (?F ?G ?J ?K).
            ?SCOPE e:optional {
                ?J math:equalTo 0.
                ("log(1/_I)-log(_K)" ?I ?K) e:calculate ?H.
            }, {
                ?K math:equalTo 0.
                ("log(_J)-log(1/_I)" ?J ?I) e:calculate ?H.
            }, {
                ?J math:notEqualTo 0.
                ?K math:notEqualTo 0.
                ("log(_J)-log(_K)" ?J ?K) e:calculate ?H.
            }.
        }
        ?YL
    ).
    ?SCOPE e:findall (
        (?H ?U1 ?U2 ?U3 ?U4)
        {
            ?YL list:member (?H ?U1 ?U2 ?U3 ?U4).
            ?H math:notLessThan 0.
        }
        ?PL
    ).
    ?PL e:sort ?PS.
    ?PS e:reverse ?PR.
    ?SCOPE e:optional {
        ((?P1 ?P2 ?P3 ?P4 ?P5) ?PI) list:append ?PR.
        ?PT log:equalTo (?P1 ?P2 ?P3 ?P4 ?P5).
    }, {
        ?PT log:equalTo ?PR.
    }.
    ?SCOPE e:findall (
        (?H ?U1 ?U2 ?U3 ?U4)
        {
            ?YL list:member (?H ?U1 ?U2 ?U3 ?U4).
            ?H math:lessThan 0.
        }
        ?NL
    ).
    ?NL e:sort ?NS.
    ?SCOPE e:optional {
        ((?N1 ?N2 ?N3 ?N4 ?N5) ?NI) list:append ?NS.
        ?NT log:equalTo (?N1 ?N2 ?N3 ?N4 ?N5).
    }, {
        ?NT log:equalTo ?NS.
    }.
    (?PT ?NT) list:append ?Y.
    ?SCOPE e:findall (
        ?H
        {
            ?YL list:member (?H ?U1 ?U2 ?U3 ?U4).
        }
        ?L
    ).
    ?L math:sum ?M.
    ?L math:memberCount ?N.
    ?SCOPE e:optional {
        ?N math:greaterThan 0.
        ("1/(1+(1/_B-1)*exp(-3.14*_M/_N))" ?B ?M ?N) e:calculate ?Z.
    }, {
        ?N math:notGreaterThan 0.
        ("_B" ?B) e:calculate ?Z.
    }.
}.
